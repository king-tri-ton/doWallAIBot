![Screenshot_6](https://github.com/king-tri-ton/doWallAIBot/assets/53092931/f010cf7a-0940-4fed-8387-e237ad487f15)

**Телеграм-бот для создания обоев на основе текстового описания с использованием OpenAI API**

---

Это телеграм-бот предназначен для создания обоев для устройств на основе текстового описания, используя модель генерации изображений от OpenAI. Пользователи могут отправлять текстовые описания, а бот использует API OpenAI для генерации изображений, которые затем отправляются обратно пользователю в качестве обоев.

---

**Установка и настройка:**

1. **Установите зависимости:**

   Перед началом использования убедитесь, что у вас установлены все необходимые зависимости. Вы можете установить их, выполнив следующую команду:

   ```
   pip install -r requirements.txt
   ```

2. **Регистрация бота в Telegram:**

   - Зарегистрируйте нового бота в Telegram, следуя инструкциям [здесь](https://core.telegram.org/bots#botfather).
   - Получите токен бота от BotFather и сохраните его.

3. **Получение API-ключа OpenAI:**

   - Зарегистрируйтесь на [сайте OpenAI](https://openai.com/).
   - Получите API-ключ, выбрав нужный тарифный план.

4. **Настройка файла конфигурации:**

   - Создайте файл `config.py` на основе `exp.config.py`.
   - Заполните поля `AI_TOKEN` (API-ключ OpenAI), `BOT_TOKEN` (токен бота Telegram) и `ADMIN_ID` (ID администратора бота).

5. **Запуск бота:**

   - После настройки всех необходимых параметров запустите файл `bot.py`:

   ```
   python bot.py
   ```

---

**Использование:**

1. **Команда /start:**

   - Начните общение с ботом, отправив команду `/start`.
   - После выполнения этой команды бот начнет ожидать от вас текстовое описание для создания обоев.

2. **Отправка текстового описания:**

   - После отправки команды `/start` отправьте боту текстовое описание, которое вы хотите преобразовать в обои.
   - Бот начнет процесс генерации изображения на основе вашего описания.

3. **Команда /stats:**

   - Для получения статистики использования бота отправьте команду `/stats`.
   - Эта команда доступна только администратору бота.

4. **Получение обоев:**

   - После генерации изображения бот отправит вам результат в виде обоев для вашего устройства.

---

**Примечание:**

- Перед использованием убедитесь, что у вас установлены все необходимые библиотеки и вы заполнили файл `config.py` корректно.
- Пожалуйста, обратите внимание, что использование OpenAI API может потребовать дополнительных платежей в зависимости от вашего тарифного плана.
- Этот бот предоставляется "как есть" без каких-либо гарантий или обязательств. Вы используете его на свой страх и риск.

---

## Changelog (Журнал событий)

<details>
<summary><strong>Версия 2.0.2</strong></summary>

- `bot.py`
    - Изменен импорт функций <strong>generate_image_url</strong> и <strong>download_and_send_image</strong> из файла <strong>functions.py</strong>.
    - Изменен импорт <strong>db</strong> на <strong>db_manager</strong> из файла <strong>db.py</strong>.
    - Вместо прямого вызова функций из модуля <strong>db</strong>, теперь используется метод <strong>create_tables()</strong> экземпляра <strong>db_manager</strong>.
    - Вместо прямого вызова функции <strong>add_user</strong> из модуля <strong>db</strong>, теперь используется метод <strong>add_user()</strong> экземпляра <strong>db_manager</strong>.
    - Вместо прямого вызова функции <strong>get_total_users</strong> из модуля <strong>db</strong>, теперь используется метод <strong>get_total_users()</strong> экземпляра <strong>db_manager</strong>.
    - Функция <strong>generate_image()</strong> была изменена на метод с тем же именем, и теперь использует функции из файла <strong>functions.py</strong>.
- `db.py`
    - Добавлен новый класс <strong>DatabaseManager</strong>.
    - Методы работы с базой данных инкапсулированы внутри этого класса.
    - Добавлена инициализация объекта <strong>DatabaseManager</strong> с указанием имени базы данных по умолчанию.
    - Использование блокировки (<strong>Lock</strong>) для защиты от потоковых проблем при одновременном доступе к базе данных.
    - Операции с базой данных выполняются в контексте блокировки (<strong>with self.lock</strong>), обеспечивая безопасность при параллельном доступе.
- `functions.py`
    - Функция <strong>generate_image_url()</strong> теперь возвращает URL сгенерированного изображения вместо его отправки.
    - Добавлена функция <strong>download_image()</strong>, которая загружает изображение по URL и сохраняет его на диск.
    - Добавлена функция <strong>send_image()</strong>, которая отправляет изображение пользователю и записывает данные об изображении в базу данных через экземпляр <strong>db_manager</strong>.
    - Добавлена функция <strong>download_and_send_image()</strong>, которая сначала загружает изображение, затем отправляет его пользователю и записывает данные об изображении в базу данных через экземпляр <strong>db_manager</strong>.
</details>

<details>
<summary><strong>Версия 2.0.0</strong></summary>

- `exp.config.py`
    - <strong>Добавлена</strong> переменная `IMAGE_FOLDER` которая содержит путь к папке для сохранения изображений.
- `bot.py`
    - <strong>Добавлена</strong> проверка длины входящего текстового сообщения перед его обработкой, чтобы убедиться, что текст не менее 10 символов.
    - <strong>Добавлена</strong> проверка на возникновение исключений при генерации изображения с использованием OpenAI. В случае возникновения ошибки, пользователю отправляется сообщение с просьбой повторить запрос или связаться с разработчиком.
    - <strong>Изменена</strong> логика сохранения изображения: теперь изображение скачивается и сохраняется в указанную папку `images` с именем в формате `<tg_id>_<message_id>.png`.
    - <strong>Изменен</strong> метод отправки изображения пользователю: теперь изображение отправляется как файловый объект, а не по URL.
- `db.py`
    - В функции `add_user(tg_id)` добавлена обработка исключений для предотвращения возможных ошибок при добавлении пользователя в базу данных.
</details>

---

**Лицензия:**

Этот проект распространяется под лицензией [MIT](https://choosealicense.com/licenses/mit/).

---

Если у вас возникли вопросы или предложения по улучшению проекта, не стесняйтесь связаться со мной по адресу mdolmatov99@gmail.com или телеграм [@king_triton](https://t.me/king_triton). Благодарю за использование моего бота!


